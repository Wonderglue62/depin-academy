<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DePIN Academy - Learn Decentralized Physical Infrastructure</title>
    
    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --color-primary: #208090;
            --color-primary-dark: #1664a7;
            --color-accent: #f59c0b;
            --color-success: #10b981;
            --color-error: #ef4444;
            --color-bg-primary: #0f172a;
            --color-bg-secondary: #1e293b;
            --color-text-primary: #f1f5f9;
            --color-text-secondary: #cbd5e1;
            --color-border: #475569;
            --color-badge-bg: rgba(32, 128, 144, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: var(--color-bg-primary);
            color: var(--color-text-primary);
            line-height: 1.6;
            height: 100%;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        /* Header & Navigation */
        .header {
            background: var(--color-bg-secondary);
            border-bottom: 1px solid var(--color-border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--color-accent);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tabs {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-tabs button {
            background: none;
            border: none;
            color: var(--color-text-primary);
            cursor: pointer;
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .nav-tabs button:hover {
            background: var(--color-bg-primary);
            color: var(--color-accent);
        }

        .nav-tabs button.active {
            color: var(--color-accent);
            border-bottom: 2px solid var(--color-accent);
        }

        /* Main Content */
        .container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .sidebar {
            width: 200px;
            background: var(--color-bg-secondary);
            border-right: 1px solid var(--color-border);
            padding: 1rem;
            overflow-y: auto;
        }

        .filters {
            margin-bottom: 2rem;
        }

        .filter-group {
            margin-bottom: 1.5rem;
        }

        .filter-group label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--color-text-secondary);
        }

        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 0.5rem;
            background: var(--color-bg-primary);
            border: 1px solid var(--color-border);
            border-radius: 4px;
            color: var(--color-text-primary);
            font-size: 0.9rem;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        /* Lessons Grid */
        .lessons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .lesson-card {
            background: var(--color-bg-secondary);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .lesson-card:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(32, 128, 144, 0.2);
        }

        .lesson-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--color-accent);
        }

        .lesson-description {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .lesson-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: var(--color-text-secondary);
        }

        .badge {
            background: var(--color-badge-bg);
            color: var(--color-primary);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .lesson-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn {
            flex: 1;
            padding: 0.6rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-dark);
        }

        .btn-secondary {
            background: var(--color-bg-primary);
            color: var(--color-text-primary);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--color-bg-secondary);
            border-radius: 8px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--color-border);
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--color-text-primary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            background: var(--color-bg-primary);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            color: var(--color-text-primary);
            font-family: inherit;
            font-size: 0.9rem;
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .form-actions button {
            flex: 1;
        }

        /* Audio Player */
        .audio-player {
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--color-bg-primary);
            border-radius: 6px;
            border: 1px solid var(--color-border);
        }

        audio {
            width: 100%;
            margin-top: 0.5rem;
        }

        .success-message {
            color: var(--color-success);
            padding: 1rem;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 6px;
            margin-top: 1rem;
        }

        .error-message {
            color: var(--color-error);
            padding: 1rem;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 6px;
            margin-top: 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--color-border);
                display: flex;
                overflow-x: auto;
            }

            .filters {
                display: flex;
                gap: 1rem;
            }

            .filter-group {
                margin-bottom: 0;
                flex: 1;
                min-width: 200px;
            }

            .lessons-grid {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                gap: 1rem;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">üéì DePIN Academy</div>
        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">Dashboard</button>
            <button class="nav-tab" data-tab="lessons">Lessons</button>
            <button class="nav-tab" data-tab="labs">Labs</button>
            <button class="nav-tab" data-tab="projects">Projects</button>
            <button class="nav-tab" data-tab="podcasts">Podcasts</button>
            <button class="nav-tab" data-tab="settings">üéôÔ∏è Podcast Settings</button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="filters">
                <div class="filter-group">
                    <label>Filter</label>
                    <input type="text" id="search" placeholder="Search lessons...">
                </div>
                <div class="filter-group">
                    <label>Difficulty</label>
                    <select id="difficulty">
                        <option value="">All Levels</option>
                        <option value="Beginner">Beginner</option>
                        <option value="Intermediate">Intermediate</option>
                        <option value="Advanced">Advanced</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <h1 id="page-title">Your Learning Dashboard</h1>
            <div id="content"></div>

            <!-- Settings Modal -->
            <div id="settingsModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <span>üéôÔ∏è Podcast Settings</span>
                        <button class="modal-close" onclick="closeSettings()">‚úï</button>
                    </div>
                    
                    <h3 style="margin-top: 1.5rem; margin-bottom: 1rem;">TTS Provider</h3>
                    
                    <div class="form-group">
                        <label>
                            <input type="radio" name="tts" value="elevenlabs" checked> ElevenLabs
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>ElevenLabs API Key</label>
                        <input type="password" id="elevenLabsKey" placeholder="sk_...">
                    </div>

                    <div class="form-group">
                        <label>Voice ID</label>
                        <input type="text" id="voiceId" placeholder="21m00Tcm4TlvDq8ikWAM" value="21m00Tcm4TlvDq8ikWAM">
                    </div>

                    <div class="form-group">
                        <label>Model</label>
                        <select id="model">
                            <option value="eleven_turbo_v2">eleven_turbo_v2 (Fast, High Quality)</option>
                            <option value="eleven_multilingual_v2">eleven_multilingual_v2 (Multilingual)</option>
                        </select>
                    </div>

                    <h3 style="margin-top: 1.5rem; margin-bottom: 1rem;">Audio Storage</h3>

                    <div class="form-group">
                        <label>
                            <input type="radio" name="storage" value="supabase" checked> Supabase
                        </label>
                    </div>

                    <div class="form-group">
                        <label>Project URL</label>
                        <input type="text" id="supabaseUrl" placeholder="https://...supabase.co">
                    </div>

                    <div class="form-group">
                        <label>Anon Key</label>
                        <input type="password" id="supabaseKey" placeholder="eyJhbGc...">
                    </div>

                    <div class="form-group">
                        <label>Bucket Name</label>
                        <input type="text" id="supabaseBucket" placeholder="depin-podcasts" value="depin-podcasts">
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="closeSettings()">Cancel</button>
                        <button class="btn btn-primary" onclick="saveSettings()">Save Configuration</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Supabase client
        const supabase = window.supabase.createClient(
            'https://onduygeyjmbyyjyhlpmhy.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9uZHV5Z2Vjam1idmp5aGxwbWh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MjA1MTIsImV4cCI6MjA4MTM5NjUxMn0.LorScX4QQZMKrNGVZRvlygoureTDRWyNN8NVyWug4eE'
        );

        // Sample lessons data
        const lessons = [
            {
                id: 'lesson-1',
                title: 'What are DePINs?',
                description: 'Introduction to Decentralized Physical Infrastructure Networks',
                difficulty: 'Beginner',
                duration: '15 min',
                podcastScript: 'Coverage through community-operated networks. Helium network. GPU compute power shared by creators globally. Sticky. Decentralized cloud storage using spare hard drive capacity. Render. API network networks in the time cloud connection is a shared economics in a UPI supply-side. Storage. Coverage through community-operated networks. Helium network. GPU compute power shared by creators globally. Sticky. Decentralized cloud storage using spare hard drive capacity. Render. API network networks in the time cloud connection is a shared economics in a UPI supply-side.',
                podcastAudioUrl: null
            },
            {
                id: 'lesson-2',
                title: 'DePIN Economics',
                description: 'Understanding the economic model of DePIN projects',
                difficulty: 'Intermediate',
                duration: '20 min',
                podcastScript: 'Participants earn rewards for contributing resources to decentralized networks. From bandwidth sharing to computing power, rewards align economic incentives with network growth. Learn how DePINs differ from traditional cloud providers.',
                podcastAudioUrl: null
            },
            {
                id: 'lesson-3',
                title: 'Building DePIN Applications',
                description: 'How to develop and deploy on DePIN infrastructure',
                difficulty: 'Advanced',
                duration: '30 min',
                podcastScript: 'Developers can build applications on DePIN infrastructure by leveraging decentralized compute, storage, and bandwidth resources. This lesson covers integration patterns, API usage, and best practices for DePIN application development.',
                podcastAudioUrl: null
            }
        ];

        // TTS Configuration
        let ttsConfig = {
            provider: 'elevenlabs',
            elevenlabs: {
                apiKey: 'sk_762384739231008626155ae2f8a694847df57fe278bbfb46',
                voiceId: '21m00Tcm4TlvDq8ikWAM',
                modelId: 'eleven_turbo_v2'
            },
            storage: {
                provider: 'supabase',
                supabase: {
                    url: 'https://onduygeyjmbyyjyhlpmhy.supabase.co',
                    anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9uZHV5Z2Vjam1idmp5aGxwbWh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MjA1MTIsImV4cCI6MjA4MTM5NjUxMn0.LorScX4QQZMKrNGVZRvlygoureTDRWyNN8NVyWug4eE',
                    bucket: 'depin-podcasts'
                }
            }
        };

        // Load settings from localStorage
        function loadSettings() {
            const saved = localStorage.getItem('tts-config');
            if (saved) {
                ttsConfig = JSON.parse(saved);
                populateSettingsForm();
            }
        }

        // Save settings
        function saveSettings() {
            ttsConfig.elevenlabs.apiKey = document.getElementById('elevenLabsKey').value;
            ttsConfig.elevenlabs.voiceId = document.getElementById('voiceId').value;
            ttsConfig.elevenlabs.modelId = document.getElementById('model').value;
            ttsConfig.storage.supabase.url = document.getElementById('supabaseUrl').value;
            ttsConfig.storage.supabase.anonKey = document.getElementById('supabaseKey').value;
            ttsConfig.storage.supabase.bucket = document.getElementById('supabaseBucket').value;

            localStorage.setItem('tts-config', JSON.stringify(ttsConfig));
            alert('‚úÖ Podcast settings saved!');
            closeSettings();
        }

        // Populate settings form
        function populateSettingsForm() {
            document.getElementById('elevenLabsKey').value = ttsConfig.elevenlabs.apiKey;
            document.getElementById('voiceId').value = ttsConfig.elevenlabs.voiceId;
            document.getElementById('model').value = ttsConfig.elevenlabs.modelId;
            document.getElementById('supabaseUrl').value = ttsConfig.storage.supabase.url;
            document.getElementById('supabaseKey').value = ttsConfig.storage.supabase.anonKey;
            document.getElementById('supabaseBucket').value = ttsConfig.storage.supabase.bucket;
        }

        // Open/close settings
        function openSettings() {
            populateSettingsForm();
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        // Generate podcast with Supabase client
        async function uploadWithSupabaseClient(audioBlob, lessonId) {
            const fileName = `${lessonId}-${Date.now()}.mp3`;
            console.log('üì§ Uploading with Supabase Client...', fileName);

            const { data, error } = await supabase.storage
                .from(ttsConfig.storage.supabase.bucket)
                .upload(fileName, audioBlob, {
                    contentType: 'audio/mpeg',
                    cacheControl: '3600',
                    upsert: false
                });

            if (error) throw new Error(`Upload failed: ${error.message}`);

            const { data: urlData } = supabase.storage
                .from(ttsConfig.storage.supabase.bucket)
                .getPublicUrl(fileName);

            console.log('‚úÖ Upload successful!', urlData.publicUrl);
            return urlData.publicUrl;
        }

        // Generate podcast
        async function generatePodcastWithClient(lessonId, scriptText) {
            try {
                console.log('[DePIN Academy] Generating podcast for', lessonId);

                // Generate TTS
                const response = await fetch('https://api.elevenlabs.io/v1/text-to-speech/' + ttsConfig.elevenlabs.voiceId, {
                    method: 'POST',
                    headers: {
                        'xi-api-key': ttsConfig.elevenlabs.apiKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: scriptText,
                        model_id: ttsConfig.elevenlabs.modelId
                    })
                });

                if (!response.ok) throw new Error(`TTS failed: ${response.status}`);

                const audioBlob = await response.blob();
                console.log('‚úÖ TTS successful:', audioBlob.size, 'bytes');

                // Upload using Supabase client
                const publicUrl = await uploadWithSupabaseClient(audioBlob, lessonId);

                // Update lesson
                const lesson = lessons.find(l => l.id === lessonId);
                if (lesson) {
                    lesson.podcastAudioUrl = publicUrl;
                    saveLessons();
                }

                // Update players
                document.querySelectorAll('audio').forEach(player => {
                    player.src = publicUrl;
                    player.load();
                });

                alert('‚úÖ Podcast ready!\n\n' + publicUrl);
                return publicUrl;

            } catch (error) {
                console.error('[DePIN Academy] Error:', error);
                alert('‚ùå Error: ' + error.message);
            }
        }

        // Save lessons
        function saveLessons() {
            localStorage.setItem('lessons', JSON.stringify(lessons));
        }

        // Load lessons
        function loadLessons() {
            const saved = localStorage.getItem('lessons');
            if (saved) {
                const savedLessons = JSON.parse(saved);
                lessons.forEach((lesson, i) => {
                    if (savedLessons[i]) lesson.podcastAudioUrl = savedLessons[i].podcastAudioUrl;
                });
            }
        }

        // Render lessons
        function renderLessons() {
            const content = document.getElementById('content');
            const search = document.getElementById('search').value.toLowerCase();
            const difficulty = document.getElementById('difficulty').value;

            const filtered = lessons.filter(l => 
                (l.title.toLowerCase().includes(search) || l.description.toLowerCase().includes(search)) &&
                (!difficulty || l.difficulty === difficulty)
            );

            content.innerHTML = `
                <div class="lessons-grid">
                    ${filtered.map(lesson => `
                        <div class="lesson-card">
                            <div class="lesson-title">${lesson.title}</div>
                            <div class="lesson-description">${lesson.description}</div>
                            <div class="lesson-meta">
                                <span class="badge">${lesson.difficulty}</span>
                                <span>${lesson.duration}</span>
                            </div>
                            <div class="audio-player">
                                <strong>üéß Podcast</strong>
                                ${lesson.podcastAudioUrl ? `
                                    <audio controls>
                                        <source src="${lesson.podcastAudioUrl}" type="audio/mpeg">
                                    </audio>
                                ` : `<p style="color: var(--color-text-secondary); margin-top: 0.5rem;">No audio yet</p>`}
                            </div>
                            <div class="lesson-actions">
                                <button class="btn btn-primary" onclick="generatePodcastWithClient('${lesson.id}', \`${lesson.podcastScript.replace(/`/g, '\\`')}\`)">
                                    üéôÔ∏è Generate Audio
                                </button>
                                <button class="btn btn-secondary" onclick="alert('Learn more about: ${lesson.title}')">Learn</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Navigation
        document.querySelectorAll('.nav-tab').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.nav-tab').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');

                const tab = e.target.dataset.tab;
                if (tab === 'settings') {
                    openSettings();
                    e.target.classList.remove('active');
                } else if (tab === 'lessons') {
                    document.getElementById('page-title').textContent = 'Lessons';
                    renderLessons();
                } else {
                    document.getElementById('page-title').textContent = tab.charAt(0).toUpperCase() + tab.slice(1);
                    document.getElementById('content').innerHTML = `<p style="color: var(--color-text-secondary);">Coming soon...</p>`;
                }
            });
        });

        // Search & filter
        document.getElementById('search').addEventListener('input', renderLessons);
        document.getElementById('difficulty').addEventListener('change', renderLessons);

        // Initialize
        loadSettings();
        loadLessons();
        renderLessons();
    </script>
</body>
</html>